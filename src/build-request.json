{
  "kind": "build_request",
  "title": "Restore movie collection connectivity by restarting stopped backend canister and improving stopped-canister UX",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Restore service by deploying an upgrade/build that brings backend canister `gnqlv-giaaa-aaaaq-awbrq-cai` back to a running state without losing existing movie data.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "ДА"
        ]
      },
      "acceptanceCriteria": [
        "After the new version is deployed, calls such as `getMovies` no longer fail with \"Reject code: 5 ... Canister ... is stopped\" for canister `gnqlv-giaaa-aaaaq-awbrq-cai`.",
        "Previously created movies are still returned by `getMovies` after the canister is running again (no data loss)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update frontend error normalization to explicitly detect the \"canister is stopped\" (Reject code 5) failure and show a clear English message that the backend canister is stopped and the user should reload after it is restarted (instead of the generic “Connection is being established…” message).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "ДА"
        ]
      },
      "acceptanceCriteria": [
        "When the replica returns an error containing text like \"Canister ... is stopped\" and/or \"Reject code: 5\", the Movies screen shows a specific English error message indicating the backend canister is stopped.",
        "The UI continues to offer a recovery action (e.g., reload) from the error state."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Fix URL hash secret cleanup so that `#caffeineAdminToken=...` (hash parameters without a `?`) is also cleared from the address bar after being read and stored in sessionStorage, while preserving other hash content/routes when present.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "ДА"
        ]
      },
      "acceptanceCriteria": [
        "Given a URL like `https://vhs-golden-era-movie-collection-7n6.caffeine.xyz/#caffeineAdminToken=TOKEN`, after app initialization the `caffeineAdminToken` is stored in sessionStorage and is removed from `window.location.hash` without a page reload.",
        "Given a URL like `https://.../#/route?caffeineAdminToken=TOKEN&other=x`, after initialization the token is removed but `#/route?other=x` remains."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo` (no additional backend services).",
    "Do not edit files under `frontend/src/components/ui` or any other paths listed in `frontend.immutablePaths`.",
    "All user-facing text introduced or modified by this change must be in English."
  ],
  "nonGoals": [
    "Adding new authentication providers (only Internet Identity remains).",
    "Implementing external monitoring/alerting or third-party uptime services.",
    "Changing the movie data model or adding new movie features beyond restoring connectivity and clearer errors."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}